// безопасный запуск звука — возвращаем промис результата (если поддерживается)
    function playAudioSafe() {
      audio.loop = true;
      audio.volume = 1.0;
      try {
        const playPromise = audio.play();
        if (playPromise !== undefined) {
          playPromise.then(() => {
            // успешно играет
          }).catch(err => {
            // ошибка при воспроизведении (например, блокировка)
            showLog('Ошибка воспроизведения: ' + (err && err.message ? err.message : err));
          });
        }
      } catch (e) {
        showLog('Исключение при попытке play(): ' + e);
      }
    }

    // Создаёт одну снежинку и анимирует её через JS (без CSS-кейфреймов)
    function createSnowflake() {
      const s = document.createElement('div');
      s.className = 'snowflake';
      s.textContent = '❄';

      const size = Math.random() * 12 + 8; // 8..20px
      s.style.fontSize = size + 'px';

      const startX = Math.random() * window.innerWidth;
      s.style.left = startX + 'px';
      s.style.top = '-30px';
      s.style.opacity = (Math.random() * 0.6 + 0.4).toString();

      // настройки анимации
      const fallDuration = Math.random() * 6 + 4; // 4..10s
      const drift = (Math.random() * 300) - 150; // -150..+150 px drift
      const rotate = (Math.random() * 720) - 360;

      s.style.transition = transform ${fallDuration}s linear, opacity ${fallDuration}s linear;
      document.body.appendChild(s);

      // Небольшая задержка чтобы transition отработал
      requestAnimationFrame(() => {
        s.style.transform = translate(${drift}px, ${window.innerHeight + 60}px) rotate(${rotate}deg);
        s.style.opacity = '0.05';
      });

      // удалить элемент когда закончил падать
      setTimeout(() => {
        s.remove();
      }, (fallDuration + 0.5) * 1000);
    }

    function startSnow() {
      if (snowInterval) return;
      // сначала создадим несколько, чтобы не ждать
      for (let i = 0; i < 8; i++) {
        setTimeout(createSnowflake, i * 120);
      }
      snowInterval = setInterval(createSnowflake, 180);
    }

    function startAll() {
      if (started) return;
      started = true;
      hint.style.display = 'none';
      playAudioSafe();
      startSnow();
    }

    // Нажатие по странице — стартуем все (а также позволяeм коду реагировать на клик по кнопке)
    wrapper.addEventListener('click', (e) => {
      startAll();
      // если клик пришёл по ссылке, позволим обработчику ссылки сработать ниже
    });

    // Т.к. ссылка ведёт в Telegram и мы хотим, чтобы она открывалась в новой вкладке
    tgBtn.addEventListener('click', (e) => {
      e.preventDefault(); // предотвратить стандартную навигацию
      startAll();         // старт звука/снега
      // попытаться открыть в новой вкладке
      const href = tgBtn.getAttribute('href');
      try {
        window.open(href, '_blank', 'noopener');
      } catch (err) {
        // если открытие заблокировано, всё равно навигируем — откроется в той же вкладке
        window.location.href = href;
      }
    });

    // Поддержка мобильных устройств: иногда сначала нужно touchstart
    window.addEventListener('touchstart', () => {
      // не вызываем напрямую startAll чтобы не мешать UX — запускится при первом клике/тапе на wrapper
    }, {passive: true});

    // Уведомление, если аудио-файл не найден (проверка загрузки)
    audio.addEventListener('error', () => {
      showLog('Ошибка: не удалось загрузить audio.mp3. Проверьте путь и имя файла (регистр букв важен).');
    });

    // Проверка, что картинка загружена для фона (необязательно, но полезно)
    const bg = new Image();
    bg.src = 'image.jpg';
    bg.onload = () => { /* ок */ };
    bg.onerror = () => {
      showLog('Предупреждение: не удалось загрузить image.jpg. Проверьте имя/расширение.');
    };

    // Подсказка: если хочешь быстро остановить звук (для отладки), открой консоль и:
    // document.getElementById('myAudio').pause()
  });
</script>
</body>
</html>
